drop dataverse channels if exists;
create dataverse channels;
use dataverse channels;

create type UserType as closed {
    objectId: string,
    userId: string,
    userName: string,
    password: string,
    email: string
}

create dataset UserDataset (UserType)
primary key objectId;

create type TweetMessageTypeuuid as closed {
	tweetid: uuid,
	message-text: string
}

create dataset TweetMessageuuids(TweetMessageTypeuuid)
primary key tweetid autogenerated;

create function NearbyTweetsContainingText($text) {
  for $tweet in dataset TweetMessageuuids
	where contains($tweet.message-text,$text)
	return $tweet.message-text 
};

create broker brokerA at "http://128.195.52.196:8989/notifybroker";



create repetitive channel nearbyTweetChannel using NearbyTweetsContainingText@1 period duration("PT10S");


insert into dataset TweetMessageuuids(
[{"message-text":"Live man"},
{"message-text":"Dead man"},
{"message-text":"Walking man"},
{"message-text":"Good man"}]
);

